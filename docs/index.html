<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PLTR: USD & NZD</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 2rem; }
    canvas { max-width: 700px; margin: 2rem auto; display: block; }
  </style>
</head>

<body>
  <h1>PLTR — USD per share & NZD aggregate</h1>
  <canvas id="pltrChart" height="350"></canvas>

  <script>
    const csvUrl =
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEJMIKmxhiNNEJ8h-sgxpsSAT8ndO5TK0EVCijAoAv4y-cmmU0YSHFUX8mC6gMBouC9k50FVFQLawN/pub?gid=1666283294&single=true&output=csv';

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: ({ data }) => {
        // find PLTR row
        const r = data.find(r => r.Ticker === 'PLTR');
        const avgCost     = parseFloat(r['Average cost'].replace(/,/g,''));
        const price       = parseFloat(r.Price.replace(/,/g,''));
        const totalCost   = parseFloat(r['Total Cost'].replace(/,/g,''));
        const marketValue = parseFloat(r['Market Value'].replace(/,/g,''));
        const nzdValue    = parseFloat(r['NZD'].replace(/,/g,''));

        // convert your cost to NZD at today’s rate
        const costNZD = totalCost * (nzdValue / marketValue);

        new Chart(document.getElementById('pltrChart'), {
          type: 'bar',
          data: {
            labels: ['Per Share', 'Aggregate'],
            datasets: [
              {
                label: 'Purchased (USD)',
                data: [avgCost, null],
                yAxisID: 'USD',
                backgroundColor: 'rgba(54,162,235,0.6)'
              },
              {
                label: 'Current (USD)',
                data: [price, null],
                yAxisID: 'USD',
                backgroundColor: 'rgba(255,159,64,0.6)'
              },
              {
                label: 'Purchased (NZD)',
                data: [null, costNZD],
                yAxisID: 'NZD',
                backgroundColor: 'rgba(75,192,192,0.6)'
              },
              {
                label: 'Current (NZD)',
                data: [null, nzdValue],
                yAxisID: 'NZD',
                backgroundColor: 'rgba(153,102,255,0.6)'
              }
            ]
          },
          options: {
            scales: {
              USD: {
                type: 'linear',
                position: 'left',
                title: { display: true, text: 'USD / share' }
              },
              NZD: {
                type: 'linear',
                position: 'right',
                title: { display: true, text: 'NZD / total' },
                grid: { drawOnChartArea: false }
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: ctx => {
                    const val = ctx.parsed.y;
                    const unit = ctx.dataset.yAxisID === 'USD' ? 'USD' : 'NZD';
                    return `${ctx.dataset.label}: ${unit} $${val.toLocaleString()}`;
                  }
                }
              },
              legend: { position: 'bottom' }
            }
          }
        });
      },
      error: err => console.error('CSV load error:', err)
    });
  </script>
</body>
</html>

