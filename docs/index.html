<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PLTR: USD & NZD</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 2rem; }
    canvas { max-width: 700px; margin: 2rem auto; display: block; }
  </style>
</head>

<body>
  <h1>PLTR — USD per share & NZD aggregate</h1>
  <canvas id="pltrChart" height="350"></canvas>

  <script>
    const csvUrl =
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEJMIKmxhiNNEJ8h-sgxpsSAT8ndO5TK0EVCijAoAv4y-cmmU0YSHFUX8mC6gMBouC9k50FVFQLawN/pub?gid=1666283294&single=true&output=csv';

    Papa.parse(csvUrl, {
      download: true,
      header: true,
      complete: ({ data }) => {
        // grab PLTR row
        const r = data.find(r => r.Ticker === 'PLTR');

        // clean & parse numbers
        const avgCostUsd     = parseFloat(r['Average cost'].replace(/[^\d.-]/g,''));
        const priceUsd       = parseFloat(r.Price.replace(/[^\d.-]/g,''));
        const totalCostUsd   = parseFloat(r['Total Cost'].replace(/[^\d.-]/g,''));
        const marketValueNzd = parseFloat(r['NZD'].replace(/[^\d.-]/g,''));

        // convert cost to NZD at today’s rate
        // note: marketValueUsd might be needed if you want historical FX; here we assume costUsd→NZD via today's rate:
        const marketValueUsd = parseFloat(r['Market Value'].replace(/[^\d.-]/g,''));
        const costNzd        = totalCostUsd * (marketValueNzd / marketValueUsd);

        new Chart(document.getElementById('pltrChart'), {
          type: 'bar',
          data: {
            labels: ['Per Share', 'Aggregate'],
            datasets: [
              {
                label: 'Avg cost/share (USD)',
                data: [avgCostUsd, null],
                yAxisID: 'USD',
                backgroundColor: 'rgba(54,162,235,0.6)'
              },
              {
                label: 'Price/share (USD)',
                data: [priceUsd, null],
                yAxisID: 'USD',
                backgroundColor: 'rgba(255,159,64,0.6)'
              },
              {
                label: 'Total cost (NZD)',
                data: [null, costNzd],
                yAxisID: 'NZD',
                backgroundColor: 'rgba(75,192,192,0.6)'
              },
              {
                label: 'Market value (NZD)',
                data: [null, marketValueNzd],
                yAxisID: 'NZD',
                backgroundColor: 'rgba(153,102,255,0.6)'
              }
            ]
          },
          options: {
            scales: {
              x: { stacked: false },
              USD: {
                type: 'linear',
                position: 'left',
                title: { display: true, text: 'USD' }
              },
              NZD: {
                type: 'linear',
                position: 'right',
                title: { display: true, text: 'NZD' },
                grid: { drawOnChartArea: false },
                ticks: {
                  callback: val => '$' + val.toLocaleString()
                }
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: ctx => {
                    const v = ctx.parsed.y;
                    const unit = ctx.dataset.yAxisID === 'USD' ? 'USD' : 'NZD';
                    return `${ctx.dataset.label}: ${unit} $${v.toLocaleString()}`;
                  }
                }
              },
              legend: { position: 'bottom' }
            }
          }
        });
      },
      error: err => console.error('CSV load error:', err)
    });
  </script>
</body>
</html>

